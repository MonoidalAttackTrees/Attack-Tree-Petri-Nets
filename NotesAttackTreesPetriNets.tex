\begin{definition}
  \label{def:Finite-Multiset}
  A \textbf{finite multiset} over a set $S$ can be defined as a formal sum: $n_1a_1, \oplus ... \oplus, n_ia_i$.
  \begin{itemize}
  \item  $n_1, ... n_i \in \mathbb{N}$, and $a_1, ... a_i \in S,$
  \item $na$: a occurs n times in multiset,
  \item $na_i \oplus ma_j = ma_j \oplus na_i$,
  \item $na \oplus ma = (m+n)a$,
  \item $na \oplus 0 = na = 0 \oplus na$.
  \end{itemize}
\end{definition}
%
\begin{definition}
  \label{def:Free-Commutative-Monoid}  
  The \textbf{free commutative monoid} generated by the set A is the set of all finite multisets drawn from A, where:
  \begin{itemize}
  \item The monoidal operation is the formal sum of multisets,
  \item The monoidal unit is $\emptyset$.
  %%$A^\oplus$ =$\{$m $|$ m is a finite multiset over A$\}$.\\
  \end{itemize}
\end{definition}
%
\begin{definition}
  \label{def:Graph}
  A \textbf{graph}, $(V, T, src, tar)$, consists of the following structure:  
  \begin{itemize}
  \item A set of nodes $V$,
  \item A set of edges $T$,
  \item A source function src: $T \to V$,
  \item A target function tar: $V \to T$.
  \end{itemize}
\end{definition}
%
\begin{definition}
  \label{def:Graph-Morphism}
  A \textbf{graph morphism}, h : $G \to G'$, between graphs is a pair (f, g) where:
  \begin{itemize}
  \item f: $T \to T'$ is a function,
  \item g: $V \to V'$ is a function.
  \end{itemize}
\end{definition}

\begin{definition}
  \label{def:Original-Petri-Net}
  Original defn: A \textbf{Petri net}, $(P, T, F, M_0)$, consists of the following structure:  
  \begin{itemize}
  \item A finite set of places $P$,
  \item A finite set of transitions $T$ that is disjoint from $P$,
  \item A causal dependency relation F: $(P \times T) + (T \times P) \to \mathbb{N}^+ $, 
  \item An initial marking $M_0$.
  \end{itemize}
\end{definition}
%
\begin{definition}
  \label{def:Petri-Net}
  A \textbf{Petri net}, $(S, T, src, tar)$, is a graph consisting of:  
  \begin{itemize}
  \item A finite set of places $S$ for nodes,
  \item A finite set of transitions $T$ for arcs,
  \item Functions $src, tar: T\to S^\oplus$.
  \end{itemize}
\end{definition}
%
%\begin{definition}
%  \label{def:Marked-Petri-Net}
%  A \textbf{marked Petri net}, $(P, T, src, tar, M_0)$, is an ordinary Petri net with an additional feature:
%  \begin{itemize}
%  \item An initial plamarking $M_0 \in P^\oplus$ where $M_0$ is of the form $a_1 \oplus ... \oplus a_j$, with no multiplicities 
%  \end{itemize}
%\end{definition}
%\begin{definition}
 % \label{place-transition-petri-net}
%  A \textbf{place-transition Petri net} is a graph, $(T, S^\oplus)$ where 
%  \begin{itemize}
% \item T is the set of transitions,
%\item S is the set of places.
%\item The elements of $S^\oplus$ model the marking required for a transition to fire at a particular place.
%  \end{itemize}
%\end{definition}
%
\begin{definition}
  \label{Monoid-Homomorphism}
  A \textbf{monoid homomorphism} between two monoids $(M_1, \oplus_1, 0_1)$ and $(M_2, \oplus_2, 0_2)$
  is a function $f: M_1 \to M_2$ such that:
  \begin{itemize}
  \item $f(a_1 \oplus_1 a_2) = f(a_1) \oplus f(a_2)$
  \item $f (0_1) = 0_2$
  \end{itemize}
\end{definition}
%
\begin{definition}
  \label{Petri-net-morphism}
  A \textbf{Petri net morphism} between two Petri nets $(T_1, S_1^\oplus)$ and $(T_2, S_2^\oplus)$ is a graph morphism (f, g)       
  where $g: S_1^\oplus \to S_2^\oplus$ is a monoid homomorphism.
\end{definition}
Thus, take as objects Petri nets $(T, S^\oplus)$ and as morphisms Petri net morphisms. This defines a category Petri.
\begin{lemma}
Suppose we have two Petri nets, $(S_1, \oplus, 0)$ and $(S_2, \oplus, 0)$.\\ 
\[(S_1 ^\oplus \times S_2 ^\oplus) \cong (S_1 + S_2)^\oplus\]
\begin{proof}
To show this, we need to define two homomorphisms between them, which we will call F and G.\\
\bigskip\\
It is important to note that the $\oplus$ operation is commutative. This commutativity allows the elements of the resulting free commutative monoid (FCM) to be rearranged, which will help us in our proof by allowing FCMs to be sorted in the following way:\bigskip\\
Consider an arbitrary $s \in (S_1 + S_2)^\oplus$. Since the generator is the disjoint union of $S_1$ and $S_2$, the elements of $s$ are drawn from those two sets, but are not grouped according to their origin set. Using commutativity, we can move all $y_i \in S_1$ to the front, and all $z_j \in S_2$ to the end. Then the form of $s$ is $(\oplus_i y_i) \oplus (\oplus_j z_j)$, where the elements are grouped according to their origin set. Any element of $(S_1 + S_2)^\oplus$ can be similarly sorted. For the purposes of this proof, assume that all such elements are so sorted.\bigskip \\
Now, let us define the function F: $(S_1 + S_2)^\oplus \to (S_1 ^\oplus \times S_2 ^\oplus)$.\\
Let k be an arbitrary element of $(S_1 + S_2)^\oplus$. We know that $k \in (S_1 + S_2)^\oplus$ must have the form $(\oplus_i y_i) \oplus (\oplus_j z_j)$, where $y_i \in S_1$ and $z_i \in S_2$ as described above. Furthermore, since the + operator is disjoint union, each element includes a marker indicating its origin set, which we can use to locate the boundary between elements of $S_1$ and elements of $S_2$. Therefore we can define F as follows:\\
\[F((\oplus_i y_i \in S_1) \oplus (\oplus_j z_j \in S_2)) = ((\oplus_i y_i \in S_1), (\oplus_j z_j \in S_2))\]
\[F((S_1, \oplus) \oplus (S_2, \oplus)) = ((S_1, \oplus), (S_2, \oplus))\]
This allows an element of $(S_1 + S_2)^\oplus$ to be matched with an element of $(S_1 ^\oplus \times S_2 ^\oplus)$, since the generator of $(S_1 + S_2)^\oplus$ contains the generator for both $S_1^\oplus$ and $S_2^\oplus$.\bigskip\\ 
Another important feature of FCMs arises from lifting the coproducts of sets to FCMs. For the coproduct of sets, we know that there exist the following functions:\\
\[inj_1: S_1 \to (S_1 + S_2) \]
\[inj_2: S_2 \to (S_1 + S_2)\]
Likewise, for the coproduct of FCMs, there are the functions: \\
\[inj^\oplus_1: S_1^\oplus \to (S_1 + S_2)^\oplus  \]
\[inj^\oplus_1(\oplus_i n_i x_i) = \oplus_i n_i(inj_1 x_i)\]
\smallskip
\[inj^\oplus_2: S_2^\oplus \to (S_1 + S_2)^\oplus \]
\[ inj^\oplus_2(\oplus_i n_i x_i) = \oplus_i n_i(inj_2 x_i)\]
Using this property, let us now define $G: (S_1 ^\oplus \times S_2 ^\oplus) \to (S_1 + S_2)^\oplus$.\\
Let $k$ be an arbitrary element of $(S_1 ^\oplus \times S_2 ^\oplus)$. We know $k$ must have the form $(M_1 , M_2)$ where $M_i$ is a multiset of the form $(n_1z_1 \oplus ... \oplus n_bz_b)$, and all $z \in S_i$ for $i\in\{1, 2\}$ (all n being natural number counters for the multiset).\\
Therefore we define the function G as follows:\\
\[G(M_1, M_2) = (inj_1^\oplus M_1) \oplus (inj_2^\oplus M_2)\]
By this transformation, we can match an element of $(S_1 ^\oplus \times S_2 ^\oplus)$ with an element of $(S_1 + S_2)^\oplus$, since by the nature of coproducts, any s $\in S_1^\oplus \in (S_1+S_2)^\oplus$, and similarly any s $\in S_2^\oplus \in (S_1+S_2)^\oplus$.\bigskip \\

Now that we have defined a homomorphism in both directions, we must
prove that $F;G = Id$ and $G;F = Id$. Take an arbitrary multiset $M$
of the form $(n_1z_1 \oplus ... \oplus n_bz_b)$, with some elements
drawn from a set $S_a$ and some drawn from $S_b$ and each $n_i \in
\mathbb{N}$. Sorting this multiset will yield the form $(\oplus_a n_a
y_a) \oplus (\oplus_b n_b z_b)$, where $y_a \in S_a$ and $z_b \in
S_b$. Putting this into the functions, we get:
\begin{center}
  \begin{math}
    \begin{array}{lll}
      G(F((\oplus_a n_a y_a) \oplus (\oplus_b n_b z_b)))
      & = & G((\oplus_a n_a y_a), (\oplus_b n_b z_b))\\
      & = & (\oplus_a n_a y_a) \oplus (\oplus_b n_b z_b)\\
    \end{array}
  \end{math}
\end{center}
Thus, $F;G = Id$.\\

Now let us check for identity in the opposite direction, proving G;F = Id.\\
Take arbitrary sets $S_a$ and $S_b$. Generate the FCM of each and then their product: $(S_a^\oplus \times S_b^\oplus)$. The result will have the form $((\oplus_a n_a y_a), (\oplus_b n_b z_b))$, where $y_a \in S_a$ and $z_b \in S_b$. Putting this into the functions, we get:\\ 
\[G((\oplus_a n_a y_a), (\oplus_b n_b z_b)) = ((\oplus_a n_a y_a) \oplus (\oplus_b n_b z_b))\] 
\[F((\oplus_a n_a y_a) \oplus (\oplus_b n_b z_b)) = ((\oplus_a n_a y_a), (\oplus_b n_b z_b))\]
Thus, G;F = Id. 
Since $(S_1 ^\oplus \times S_2 ^\oplus) \leftrightarrow (S_1 + S_2)^\oplus$, we can conclude that $(S_1 ^\oplus \times S_2 ^\oplus) \cong (S_1 + S_2)^\oplus$.\\
\end{proof}
%
\end{lemma}
%
\begin{definition}
  \label{Chainable-Petri-Net}
  A \textbf{chainable petri net}, $(S, T, src, tar, i, f)$ is a Petri net with the following additional features: 
  \begin{itemize}
  \item An element i that is the starting point for the net. If the initial marking is $(s_1 \oplus s_2 ... \oplus s_n)$, then $i \to (s_1 \oplus s_2 ... \oplus s_n)$, with elements not duplicated: $s_j \neq s_k$ when $j \neq k$. Also, $\emptyset \to i$. That is, $i$ cannot be reached from within the net. 
  \item An element f that is the endpoint of the net. If the final marking is $(s_1 \oplus s_2 ... \oplus s_n)$, $(s_1 \oplus s_2 ... \oplus s_n) \to f$, and $f \to \emptyset$. 
   \item Morphisms for chainable nets must preserve both i and f. So, a morphism $<a,b>: (N, i, f) \to (N', i', f')$ is an ordinary net morphism that preserves the markings $b(i) = i'$ and $b(f) = f'$. 
 \end{itemize}
\end{definition}
The chainable petri net, or CNET, is a petri net that tracks both its initial and its final places, to facilitate chaining the petri net together with other petri nets at either end. This enables the use of operators such as OR, SEQ, \& AND.\\
Suppose we have two CNETs, $(N_1, i_1, f_1)$ and $(N_2, i_2, f_2)$. \\
$N_1 = (src, tar: T \to S^\oplus)$ and $N_2 = (src', tar': T' \to S'^\oplus)$.\bigskip\\
%SEQ for CNETs is the composition operation:\\
%$N_1$ ; $N_2$ = $T + T' \to S^\oplus + S'^\oplus$;\\
%$i = i_1;$\\
%$f = f_2;$\\
%$f_1 \to i_2$;\\
%AND for CNETs is the tensor product?(under construction):\\
%$N_1$ AND $N_2$ = $N_1 \times N_2$ = $N_3$, where $(N_3,  i_3, f_3)$ such that:\\
%$N_1 \times N_2$ = $T_1 \times T_2 \to S_1^\oplus \times S_2^\oplus$;\\
%$i_3$ is a new place;\\
%$src(i_3 \times \emptyset) = \emptyset;$\\
%$tar(i_3\times \emptyset) =\{i_1 \oplus i_2\};$\\
%$f_3$ is a new place;\\
%$src(f_3\times \emptyset) = \{f_1 \oplus f_2\};$\\
%$tar(f_3\times \emptyset) = \emptyset;$ \bigskip\\
%OR for CNETs is the coproduct(p.126):\\
\begin{example}
  \label{ex:OR-PN}
Let us examine disjunction (OR) in CNETs, starting with a basic example. Consider an ordinary Petri net $(P_x, T_x, src_x, tar_x)$. A simple model of the disjunction $p_2 OR p_3$ is given by the following relations:
  \begin{itemize}
  \item Let $P = \{p_1, p_2, p_3\}$, and $src_x, tar_x$: $(p_1) \to (p_3)$, and $(p_2) \to (p_3)$. 
  \item Given this relation, as long as $p_1, p_2,$ or both are activated, $p_3$ will be activated. 
  \item If neither $p_1$ nor $p_2$ are activated, $p_3$ will also remain inactive.  
  \end{itemize}
Within a single Petri net, we can see that disjunction is modeled graphically by two transition arcs leading to one place. If either transition fires, the place will be activated, enabling its subsequent transition(s) to fire. The disjunction of two CNETs will result in a similar pattern: if at least one of the CNET disjuncts reaches its final marking, then the disjunction itself will reach its final marking.   
\end{example}
\begin{definition}
  \label{def:OR-PN}
  Given two CNETs, $N_1= (P_1, T_1, src_1, tar_1, i_1, f_1)$ and $N_2= (P_2, T_2, src_2, tar_2, i_2, f_2)$, their \textbf{disjunction} is $N_1 + N_2$, where: 
\begin{itemize}
\item The initial place $i = (i_1 , i_2)$.
\item The final place $f_3$ is a new place.
\item P = $((P_1 + P_2) + \{(i_1 , i_2)\} + \{f_1\} + \{f_2\} + \{f_3\}).$ NOTE do we include i and f in P or are they separate?
\item T = ($T_1 + T_2$ + ($f_1 \to f_3$) + ($f_2 \to f_3$) + ($f_3 \to \emptyset$)).
\item $[src_1, src_2], [tar_1, tar_2]: T\to P^\oplus$. 
\end{itemize}
We form the initial place of the disjunction by pairing the initial places of the two disjuncts, so that each branch of the disjunction can be reached initially. The final place is a new place that is the target of the final place of each disjunct, so that the completion of either branch (or both) can trigger the disjunction's final place. The disjunction's places gather these elements together, along with the places of each branch. Finally, the src and tar functions appropriate to each branch are used to compute runs, with the addition of the new transitions for f.  
\end{definition}
\begin{lemma}
  \label{lemma:OR-coproduct}
  The disjunction of two CNETs, $A + B$, is a coproduct. 
\end{lemma}
\begin {proof}
%%%fix inj functions
$N_1 + N_2$ is a coproduct if it has morphisms $i_1: A \to A + B$ and $i_2: B \to A + B$ such that for any object C with morphisms $f: A\to C$ and $g: B\to C$, there is a unique morphism $h: A + B \to C$ such that $f = i_1;h$ and $g = i_2; h$, meaning that this diagram commutes:\\
\begin{center}
  \begin{math}
    \bfig
    \Atrianglepair|mmmaa|/<-`<-`<-`->`<-/<1000,500>[
      C`
      A`
      A+B`
      B;
      f`
      h`
      g`
      i_1`
      i_2]
    \efig
  \end{math}
\end{center}
Let $A = (P_A, T_A, src_A, tar_A, i_A, f_A)$ and $B = (P_B, T_B, src_B, tar_B, i_B, f_B)$, and take A + B.\\
Let us define $i_0$ and $i_1$, which are injections for Petri nets. We will take it by parts for clarity.\\
$P_{A+B} = (P_A +P_B+\{(i_A, i_B)\} +\{f_A\} + \{f_B\})$\\
The coproduct of sets of places has the injective functions already, which covers all the constituents except the initial places. For the initial places, $i_A \to i_A \times i_B$ and $i_B \to i_A \times i_B$ just maps the individual initial place to the pair of initial places, using the position in the pair to indicate whether it is $i_A$ or $i_B$.\\
$T_{A+B} = T_A + T_B$, so again we can use the coproduct of sets to obtain the injective functions for this part of the net.\\
 $[src_1, src_2], [tar_1, tar_2]: T\to P^\oplus$. These functions already respect set membership, and so their injective function is also clear. Since these composite pieces are all coproducts, we can rely on their injections to yield the injections of the larger structure.\smallskip\\ 
Now, suppose we have another CNET C and morphisms $f: A\to C$ and $g: B\to C$; we define $h$ as follows:\\
  \begin{equation}
    h(x)=
    \begin{cases}
      f(x), & \text{if x is from A}\\
      g(x), & \text{if x is from B}
    \end{cases}
  \end{equation}
Given this definition of $h$, it is clear that $f = i_1;h$ and $g = i_2;h$, since h(x) applies f(x) if $x \in A$ and g(x) if $x \in B$.\\
To show that this satisfies the uniqueness requirement, let us consider an arbitrary function $k : (A+B) \to C$, where $i_1;k = f$ and $i_2;k = g$. For $a\in A$ and $b\in B$, the following equalities hold:\\ 
\begin{equation}
i_1(a);k(a) = f(a) = h(a) 
\end {equation}
\begin{equation}
i_2(b);k(b) = g(b) = h(b)
\end{equation}
Thus, $h = k$, showing that $h$ is unique. 
This provides a morphism as required, showing that the CNET disjunction is a coproduct.  
\bigskip\\
\end{proof}
\begin{definition}
  \label{def:AND-PN}
  Given two CNETs, $N_1= (P_1, T_1, src_1, tar_1, i_1, f_1)$ and $N_2= (P_2, T_2, src_2, tar_2, i_2, f_2)$, their \textbf{conjunction} is $N_1 \times N_2$, where: 
\begin{itemize}
\item The initial place $i = (i_1 , i_2)$.
\item The final place $f = (f_1, f_2)$ is a new place.
\item P = $((P_1 \times P_2) + \{(i_1 , i_2)\} + \{(f_1, f_2)\})$.
\item T = ($T_1 \times T_2$).
\item $[src_1, src_2], [tar_1, tar_2]: T\to P^\oplus$. 
\end{itemize}
We form the initial and final places of the conjunction by pairing the initial and final places of the two conjuncts, ensuring each can be reached initially, and requiring that both complete in order to complete the conjunction of the two branches. The conjunction's places gather these elements together, along with the places of each branch. Finally, the src and tar functions appropriate to each branch are used to compute runs. Transitions are paired, making these two branches run in parallel. NOTE: parallelization a good thing or bad thing?  
\end{definition}
\newpage
Example nets:
%
K = \\
$S_K :\{ a, b, c\}$\\
$T_K :\{t\}$\\  
$F_K (a, t) = 2$\\
$F_K (b, t) = 1$\\
$F_K (t, c) = 2$\\
$F_K (else) = 0$\\
%
$S_K^\oplus :\{ 2a \oplus 1b \oplus 2c\}$\\
$t = \{ 2a \oplus 1b \to 2c \}$\\  
$\delta_{0K} (t) = 2a \oplus 1b \}$\\
$\delta_{1K} (t) = 2c \}$\\
\smallskip
M = \\
$S_M :\{d,e\}$\\
$T_M :\{t'\}$\\  
$F_M (d, t') = 2$\\
$F_M (t', e) = 1$\\
$F_M (else) = 0$\\
%
$S_M^\oplus :\{ 2d \oplus 1e\}$\\
$t = \{ 2d \to 1e \}$\\  
$\delta_{0M} (t') = 2d \}$\\
$\delta_{1M} (t') = 1e \}$\\
\smallskip
$S_K^\oplus \times S_M^\oplus = (2a \oplus 1b, 2d) \to (2c, 1e)$\\
\smallskip
$(S_K + S_M)^\oplus = (\{1\} \times S_K) \cup (\{2\} \times S_M)^\oplus$\\
$((1, 2a), (1, 1b), (2, 2d))^\oplus = $\\
$S_{KM}^\oplus: \{(1, 2a), (1, 1b), (2, 2d) \}$\\
$T_{KM}: \{t_1, t_2\}$\\
$t_1 = ((1, 2a) \oplus (1, 1b)) \to (1, 2c)$\\
$t_2 = (2, 2d) \to (2, 1e)$\\
$\delta_{0KM} (t_1) = (1, 2a) \oplus (1, 1b) \}$\\
$\delta_{0KM} (t_2) = (2, 2d) \}$\\
$\delta_{1KM} (t_1) = (1, 2c) \}$\\
$\delta_{1KM} (t_2) = (2, 1e) \}$\\
\smallskip
$(S_1 ^\oplus \times S_2 ^\oplus)$ and $(S_1 + S_2)^\oplus$ are isomorphic. \\
Suppose there are two Petri nets $S_1 and S_2$, with sets of places $M_1 and M_2$ and sets of arcs $T_1 and T_2.$\\
Let F be the homomorphism from $(S_1 + S_2)^\oplus$ to $(S_1 ^\oplus \times S_2 ^\oplus)$. \\
$F((S_1 + S_2)^\oplus) = (S_1 ^\oplus + S_2 ^\oplus)$\\
where $S_1 + S_2 = (\{1\} \times S_1) \cup (\{2\} \times S_2)$\\
For F:\\
Calculating the set of places of the codomain:\\
  $S_1 =  \bigcup_{ y \in domain (x, y)} | x=1)$\\
  $S_2 =  \bigcup_{y \in domain (x, y)} | x=2)$\\
Note: I mean to separate out the two sets using the disjoint markers here.\\
The set of places of the codomain = $(S_1 ^\oplus \times S_2 ^\oplus)$\\
The arrows of the codomain maintain the structure defined in the domain, disregarding the origin markers \{1\} and \{2\} added in by taking the disjoint union.\\
Since the function preserves the structure between the objects, only changing the names of the objects, this is a homomorphism.\\
Now, let G be the homomorphism from $(S_1 ^\oplus \times S_2 ^\oplus)$ to $(S_1 + S_2)^\oplus$. \\
The objects or places of the codomain are the objects of the domain modified in the following way:\\
where objects in the domain have the form $(x, y), (\{1\} \times x) \cup (\{2\} \times y).$\\
The arrows of the codomain maintain the structure of the domain, adding in origin markers \{1\} and \{2\} by position as described above.\\
Since G preserves the group's structure and only modifies objects' names, it is a homomorphism. 
Clearly,$ G \circ F = F \circ G,$ since F removes the origin markings  \{1\} and \{2\} and G puts them back. Structure remains unchanged in either direction.\\
\newpage

% subsection MeseguerMontanari (end)
